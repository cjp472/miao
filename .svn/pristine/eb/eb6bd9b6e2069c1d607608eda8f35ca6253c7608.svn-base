package com.liuzhuni.lzn.db;

import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;

import java.util.ArrayList;
import java.util.List;

/**
 * Created by Andrew Lee on 2015/5/30.
 * E-mail:jieooo7@163.com
 * Date: 2015-05-30
 * Time: 17:40
 */
public class DatabaseOperate {

    public static void insert(SQLiteDatabase db,List<DbModel> lists){
        delete(db);
        db.beginTransaction(); // 事务处理
        try {
            for (DbModel list : lists) {
                db.execSQL(
                        "INSERT INTO goods_record VALUES(null, ?, ?)",
                        new Object[] { list.getType(), list.getBody() });
            }
            db.setTransactionSuccessful(); // 成功
        } finally {
            db.endTransaction(); // 结束事务
        }

    }


    public static void delete(SQLiteDatabase db){
        Cursor c = db.rawQuery("SELECT id FROM goods_record", null);
        int count=c.getCount();

        if(count>16){
            int limit=count-16;
            Cursor cc = db.rawQuery("SELECT id FROM goods_record ORDER BY id ASC limit"+limit, null);
            while(cc.moveToNext()){
                db.execSQL("DELETE FROM goods_record WHERE id="+cc.getInt(cc.getColumnIndex("id")));
            }
            cc.close();
        }
        c.close();

    }

    public static List<DbModel> getDb(SQLiteDatabase db){
        Cursor c = db.rawQuery("SELECT * FROM goods_record", null);
        List<DbModel> list=new ArrayList<DbModel>();
        while (c.moveToNext()) {
            list.add(new DbModel(c.getInt(c.getColumnIndex("type")),c.getString(c.getColumnIndex("body"))));

        }

        c.close();

        return list;
    }
}
